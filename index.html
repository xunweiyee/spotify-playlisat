<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Spotify Playlist from Text</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.0/css/bulma.min.css">
    <script type="text/javascript" src="spotify-web-api.js"></script>
  </head>
  <body>

    <!-- title -->
    <section class="section">
      <div class="container">
        <h1 class="title">
          Spotify Playlist from Text
        </h1>
        <p class="subtitle">
          The easy way to auto-generate playlist.
        </p>
      </div>
    </section>

    <section>
      <div class="container">
        <div class="columns is-vcentered">
          <div class="column is-half">

            <!-- input text area -->
            <textarea id="inputText" class="textarea" placeholder="e.g. Set Fire to the Rain - Adele" rows="15"></textarea>

            <!-- split input -->
            <div class="columns mt-2">
              <div class="column is-one-fifth">
                <p class="">Split input</p>
              </div>
              <!-- radio -->
              <div class="column is-one-third">
                <div class="control">
                  <label class="radio">
                    <input id="space" type="radio" name="radio-in" checked>
                    Space
                  </label>
                  <label class="radio">
                    <input id="tab" type="radio" name="radio-in">
                    Tab
                  </label>
                </div>
              </div>
              <!-- checkbox -->
              <div class="column">
                <label class="checkbox"><input type="checkbox" name="cb-in" value="0">1</label>
              </div>
              <div class="column">
                <label class="checkbox"><input type="checkbox" name="cb-in" value="1">2</label>
              </div>
              <div class="column">
                <label class="checkbox"><input type="checkbox" name="cb-in" value="2">3</label>
              </div>
              <div class="column">
                <label class="checkbox"><input type="checkbox" name="cb-in" value="3">4</label>
              </div>
              <div class="column">
                <label class="checkbox"><input type="checkbox" name="cb-in" value="4">5</label>
              </div>
            </div>

            <!-- replace text -->
            <div class="field has-addons">
              <div class="control is-expanded">
                <input id="replaceTerm" class="input" type="text" placeholder="e.g. Artist">
              </div>
              <div class="control">
                <button onclick="replaceText()" class="button is-info">
                  Replace
                </button>
              </div>
            </div>

            <!-- buttons -->
            <div id="regexbtn" class="buttons is-right">
              <button class="button" onclick="removeLine()">empty lines</button>
              <button class="button" onclick="removeNumber()">numbers</button>
              <button class="button" onclick="removeSymbol()">symbols</button>
              <button class="button" onclick="processText()">all</button>
            </div>

            <!-- split output -->
            <div class="columns mt-2">
              <div class="column is-one-fifth">
                <p class="">Split output</p>
              </div>
              <!-- radio -->
              <div class="column is-one-third">
                <div class="control">
                  <label class="radio">
                    <input id="space-out" type="radio" name="radio-out" checked>
                    Space
                  </label>
                  <label class="radio">
                    <input id="tab-out" type="radio" name="radio-out">
                    Tab
                  </label>
                </div>
              </div>
              <!-- checkbox -->
              <div class="column">
                <label class="checkbox"><input type="checkbox" name="cb-out" value="0">1</label>
              </div>
              <div class="column">
                <label class="checkbox"><input type="checkbox" name="cb-out" value="1">2</label>
              </div>
              <div class="column">
                <label class="checkbox"><input type="checkbox" name="cb-out" value="2">3</label>
              </div>
              <div class="column">
                <label class="checkbox"><input type="checkbox" name="cb-out" value="3">4</label>
              </div>
              <div class="column">
                <label class="checkbox"><input type="checkbox" name="cb-out" value="4">5</label>
              </div>
            </div>     

            <!-- paste and clear -->
            <div id="regexbtn" class="buttons is-right">
              <button class="button" onclick="pasteText()">Paste</button>
              <button class="button is-danger is-left" onclick="clearText()">Clear</button>
            </div>

          </div>

          <div class="column is-half">
            <!-- outputText text area -->
            <div class="control">
              <textarea id="outputText" class="textarea" readonly rows=24></textarea>
            </div>

            <!-- spotify -->
            <div class="buttons is-right mt-4">
              <button class="button is-success">Generate Spotify Playlist</button>
            </div>

          </div>
        </div>
      </div>
    </section>

  </body>
</html>



<script>
  let inputTa = document.getElementById("inputText");
  inputTa.onpaste = pasteText;

  function toOutput(txt=document.getElementById("inputText").value) {
    document.getElementById("outputText").value = txt;
    currOutputText = document.getElementById("outputText").value;
  }

  function pasteText(event) {
    var checkboxesIn = document.querySelectorAll("input[name=cb-in]");
    for (i=0; i<checkboxesIn.length; i++) {
        checkboxesIn[i].checked = true;
    }

    setTimeout(getInput, 100);

    function getInput(){ 
      let txt = document.getElementById("inputText").value;
      toOutput(txt);
    }

    // alert(txt);
    //setTimeout(function(){ alert("Hello"); }, 3000);
    // toOutput(txt);
  }

  function clearText() {
    var checkboxesIn = document.querySelectorAll("input[name=cb-in]");
    for (i=0; i<checkboxesIn.length; i++) {
        checkboxesIn[i].checked = false;
    }

    toOutput("");
  }

  function replaceText() {
    var term = document.getElementById("replaceTerm").value;
    var txt = document.getElementById("outputText").value;
    txt = txt.replaceAll(term, "");

    toOutput(txt);
  }

  function removeLine() {
    var txt = document.getElementById("outputText").value;
    txt = txt.replace(/^\s*[\r\n]/g, '');
    // txt = txt.replace(/\t+/g, ' ');
    txt = txt.replace(/  +/g, ' ');

    toOutput(txt);
  }

  function removeNumber() {
    var txt = document.getElementById("outputText").value;
    txt = txt.replace(/\d+/g,'');

    toOutput(txt);
  }

  function removeSymbol() {
    var txt = document.getElementById("outputText").value;
    txt = txt.replace(/[`~!@#$%^&*()_|+\-=?;:'",.<>\{\}\[\]\\\/]/gi, ' ')

    toOutput(txt);
  }

  // checkboxes to split input
  var checkboxesIn = document.querySelectorAll("input[name=cb-in]");
  checkboxes = checkboxesIn;
  for (var i=0, len=checkboxes.length; i<len; i++) {
    getCb(checkboxes, i);
  }

  var checkboxesOut = document.querySelectorAll("input[name=cb-out]");
  checkboxes = checkboxesOut;
  currOutputText = "";
  // currOutputText = document.getElementById("outputText").value;
  for (var i=0, len=checkboxes.length; i<len; i++) {
    getCb(checkboxes, i, true);
  }

  function getCb(checkboxes, i, output=false) {
    if ( checkboxes[i].type === 'checkbox') {
        checkboxes[i].onclick = function() {
          var checkboxesChecked = [];
          // loop over them all
          for (var i=0; i<checkboxes.length; i++) {
             // And stick the checked ones onto an array...
             if (checkboxes[i].checked) {
                checkboxesChecked.push(checkboxes[i].value);
             }
          }
          // alert(checkboxesChecked);

          splitLine(checkboxesChecked, output);
        }
    }
  }

  function splitLine(checkboxesChecked, output) {
    var tabRadioId = "tab";
    var inputAreaId = "inputText";
    var txt = document.getElementById(inputAreaId).value;

    if (output) {
      tabRadioId = "tab-out";
      inputAreaId = "outputText";
      txt = currOutputText;
    }

    var separator = " "
    if (document.getElementById(tabRadioId).checked) {
      separator = "\t"
    }
    // alert(separator)

    lines = txt.match(/[^\r\n]+/g);
    // alert(checkboxesChecked);
    var outputText = "";
    for (var i=0; i<lines.length; i++) {
      line = lines[i].trim()
      line = line.split(separator);
      var temp = "";
      for (var j=0; j<checkboxesChecked.length; j++) {
        temp = temp + " " + line[checkboxesChecked[j]]
      }
      outputText = outputText + temp + "\n";
    }
    // alert(outputText);
    if (output==true) {
      document.getElementById("outputText").value = outputText;
    } else {
      toOutput(outputText);
    }
  }



  redirectUri = "https://xunweiyee.github.io/spotify-playlist/redirect";

  url = `https://accounts.spotify.com/authorize?client_id=${clientId}&redirect_uri=${redirectUri}&scope=user-read-private%20user-read-email&response_type=token&state=123`;
  console.log(url);


  // https://accounts.spotify.com/authorize?client_id=5fe01282e94241328a84e7c5cc169164&redirect_uri=http:%2F%2Fexample.com%2Fcallback&scope=user-read-private%20user-read-email&response_type=token&state=123







</script>

<!-- https://developer.spotify.com/documentation/general/guides/authorization-guide/ -->